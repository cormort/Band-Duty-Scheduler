<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨‚åœ˜å€¼ç­è¡¨ç”¢ç”Ÿå™¨ (å«æš‘è¨“ç‰ˆ)</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            background-color: #f0f2f5;
        }
        h2 { color: #333; text-align: center; margin-bottom: 20px; }

        /* è¨­å®šå€å¡Š */
        .config-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #555;
            margin-bottom: 15px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .date-range-global {
            text-align: center;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .date-range-global input { padding: 5px; border: 1px solid #ccc; border-radius: 4px; }

        /* æ ¼ç‹€ä½ˆå±€ */
        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .action-card {
            padding: 15px;
            border-radius: 8px;
            background: #fff;
            border: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        /* ä¸åŒé¡å‹çš„å¡ç‰‡é¡è‰² */
        .card-ab { border-top: 4px solid #4CAF50; }
        .card-silk { border-top: 4px solid #9C27B0; }
        .card-training { border-top: 4px solid #FF5722; background-color: #fff8f5; } /* æš‘è¨“ç‰¹åˆ¥è‰² */

        .card-header { font-weight: bold; font-size: 1.1em; color: #333; text-align: center; }
        
        .input-row { display: flex; justify-content: space-between; align-items: center; font-size: 0.9em; }
        .input-row input { width: 60%; padding: 5px; border: 1px solid #ddd; border-radius: 4px; text-align: center; }
        .input-row label { width: 35%; color: #666; }

        /* æŒ‰éˆ•æ¨£å¼ */
        button {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
            color: white;
            transition: 0.2s;
            margin-top: auto; /* æ¨åˆ°åº•éƒ¨ */
        }
        button:hover { opacity: 0.9; }
        button:active { transform: scale(0.98); }

        .btn-ab { background-color: #4CAF50; }
        .btn-silk { background-color: #9C27B0; }
        .btn-train { background-color: #FF5722; } /* æ©˜è‰² */
        
        /* åº•éƒ¨å·¥å…·åˆ— */
        .toolbar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .btn-add { background-color: #607D8B; width: auto; padding: 10px 25px; }
        .btn-copy { background-color: #2196F3; width: auto; padding: 10px 30px; font-size: 1.1em; }
        .btn-clear { background-color: white; border: 1px solid #ccc; color: #666; width: auto; padding: 10px 20px; }
        .btn-clear:hover { background-color: #ffebee; color: #d32f2f; border-color: #d32f2f; }

        /* è¡¨æ ¼æ¨£å¼ */
        .table-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }
        th, td {
            border: 1px solid #e0e0e0;
            padding: 8px;
            text-align: center;
            vertical-align: middle;
        }
        th { background-color: #f8f9fa; color: #495057; }
        
        input.editable-cell {
            width: 95%;
            border: 1px solid transparent;
            text-align: center;
            font-size: 15px;
            background: transparent;
            font-family: inherit;
            padding: 5px 0;
        }
        input.editable-cell:hover, input.editable-cell:focus {
            border: 1px solid #2196F3;
            background: #fff;
            border-radius: 4px;
        }
        
        .del-btn { 
            background: none; border: none; color: #ccc; font-size: 18px; cursor: pointer; padding: 0 5px; width: auto;
        }
        .del-btn:hover { color: #f44336; }
    </style>
</head>
<body>

    <h2>æ¨‚åœ˜å€¼ç­è¡¨ç”¢ç”Ÿå™¨ (å«æš‘è¨“åŠŸèƒ½)</h2>

    <div class="config-section">
        <div class="section-title">Step 1: è¨­å®šå­¸æœŸåœ˜ç·´ (ä¾‹è¡Œç·´ç¿’)</div>
        <div class="date-range-global">
            å­¸æœŸå€é–“ï¼š
            <input type="date" id="semStartDate"> è‡³ <input type="date" id="semEndDate">
        </div>

        <div class="action-grid">
            <div class="action-card card-ab">
                <div class="card-header">ğŸ» A/B åœ˜ (é€±äºŒ/å››)</div>
                <div class="input-row">
                    <label>æ™‚é–“</label>
                    <input type="text" id="timeAB" value="16:00~18:30">
                </div>
                <button class="btn-ab" onclick="generateSemester('AB')">ç”¢ç”Ÿ A/B åœ˜è¡¨</button>
            </div>

            <div class="action-card card-silk">
                <div class="card-header">ğŸ‹ çµ²ç«¹åœ˜ (é€±ä¸‰)</div>
                <div class="input-row">
                    <label>æ™‚é–“</label>
                    <input type="text" id="timeSilk" value="12:00~15:00">
                </div>
                <button class="btn-silk" onclick="generateSemester('Silk')">ç”¢ç”Ÿ çµ²ç«¹åœ˜è¡¨</button>
            </div>
            
            <div class="action-card" style="border-top: 4px solid #333;">
                <div class="card-header">âœ¨ å­¸æœŸç¸½è¡¨</div>
                <div style="font-size: 0.9em; color: #666; text-align: center; margin: 10px 0;">
                    åŒæ™‚ç”¢ç”Ÿé€±äºŒã€ä¸‰ã€å››<br>æ‰€æœ‰ä¾‹è¡Œç·´ç¿’
                </div>
                <button style="background-color: #333;" onclick="generateSemester('All')">ç”¢ç”Ÿ åˆä½µç¸½è¡¨</button>
            </div>
        </div>
    </div>

    <div class="config-section" style="border: 2px solid #FF5722;">
        <div class="section-title" style="color: #FF5722; border-color: #ffd8cc;">Step 2: åŠ å…¥æš‘è¨“ / å¯’è¨“ (é€£çºŒæ—¥æœŸ)</div>
        <div class="action-grid" style="grid-template-columns: 1fr;">
            <div class="action-card card-training" style="flex-direction: row; flex-wrap: wrap; align-items: flex-end; justify-content: center;">
                <div style="display: flex; gap: 10px; align-items: center;">
                    <label>é–‹å§‹ï¼š</label><input type="date" id="trainStartDate" style="padding: 8px;">
                    <label>çµæŸï¼š</label><input type="date" id="trainEndDate" style="padding: 8px;">
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="text" id="trainName" value="æ¨‚åœ˜æš‘è¨“" placeholder="æ´»å‹•åç¨±" style="padding: 8px; width: 120px;">
                    <input type="text" id="trainTime" value="09:00~16:00" placeholder="æ™‚é–“" style="padding: 8px; width: 100px;">
                </div>
                <button class="btn-train" style="width: auto; padding: 10px 20px;" onclick="addTrainingBatch()">ï¼‹ åŠ å…¥è¨“ç·´æ—¥ç¨‹</button>
            </div>
        </div>
        <div style="text-align: center; font-size: 0.9em; color: #FF5722; margin-top: 10px;">
            ğŸ’¡ é»æ“ŠåŠ å…¥å¾Œï¼Œæœƒè‡ªå‹•é¿é–‹é€±å…­ã€é€±æ—¥ã€‚æ­¤åŠŸèƒ½æ¡ã€Œç´¯åŠ ã€æ–¹å¼ï¼Œä¸æœƒæ¸…ç©ºä¸Šæ–¹å·²å»ºç«‹çš„å­¸æœŸè¡¨ã€‚
        </div>
    </div>

    <div class="toolbar">
        <button class="btn-add" onclick="addManualRow()">ï¼‹ æ‰‹å‹•æ–°å¢ä¸€åˆ—</button>
        <button class="btn-copy" onclick="copyTable()">ğŸ“‹ è¤‡è£½è¡¨æ ¼åˆ° Excel</button>
        <button class="btn-clear" onclick="clearTable()">ğŸ—‘ï¸ æ¸…ç©ºå…¨éƒ¨</button>
    </div>

    <div class="table-container">
        <table id="scheduleTable">
            <thead>
                <tr>
                    <th style="width: 100px;">æ—¥æœŸ</th>
                    <th style="width: 60px;">æ˜ŸæœŸ</th>
                    <th style="width: 250px;">å€¼ç­æ™‚æ®µ/æ´»å‹•å…§å®¹</th>
                    <th style="width: 130px;">æ™‚é–“</th>
                    <th>å€¼ç­å®¶é•·ä¸€</th>
                    <th>å€¼ç­å®¶é•·äºŒ</th>
                    <th>å€¼ç­å®¶é•·ä¸‰</th>
                    <th style="width: 40px;"></th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
        <div id="emptyMsg" style="text-align: center; color: #999; padding: 40px;">
            ç›®å‰ç„¡è³‡æ–™ï¼Œè«‹ç”±ä¸Šæ–¹ç”¢ç”Ÿè¡Œç¨‹
        </div>
    </div>

    <datalist id="activityOptions">
        <option value="Aåœ˜åˆå¥ï¼Båœ˜åˆ†çµ„">
        <option value="Aåœ˜åˆ†çµ„ï¼Båœ˜åˆå¥">
        <option value="çµ²ç«¹åœ˜åˆå¥">
        <option value="çµ²ç«¹åŠ ç·´">
        <option value="Aåœ˜åŠ ç·´">
        <option value="Båœ˜åŠ ç·´">
        <option value="æ¨‚åœ˜æš‘è¨“">
        <option value="æ¨‚åœ˜å¯’è¨“">
        <option value="åˆ†éƒ¨æš‘è¨“">
        <option value="æˆç™¼å½©æ’">
    </datalist>

    <script>
        // åˆå§‹åŒ–æ—¥æœŸ
        window.onload = function() {
            const today = new Date();
            const threeMonthsLater = new Date();
            threeMonthsLater.setMonth(today.getMonth() + 3);
            
            // å­¸æœŸé è¨­
            document.getElementById('semStartDate').valueAsDate = today;
            document.getElementById('semEndDate').valueAsDate = threeMonthsLater;

            // æš‘è¨“é è¨­ (é è¨­ç‚ºç•¶å‰æ—¥æœŸçš„ä¸‹ä¸€é€±ä¸€é–‹å§‹)
            const nextMon = new Date();
            nextMon.setDate(today.getDate() + (1 + 7 - today.getDay()) % 7);
            const nextFri = new Date(nextMon);
            nextFri.setDate(nextMon.getDate() + 4);
            
            document.getElementById('trainStartDate').valueAsDate = nextMon;
            document.getElementById('trainEndDate').valueAsDate = nextFri;
        };

        const daysMap = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];

        // --- åŠŸèƒ½ 1: ç”¢ç”Ÿå­¸æœŸä¾‹è¡Œè¡¨ (æœƒå…ˆæ¸…ç©º) ---
        function generateSemester(mode) {
            const start = document.getElementById('semStartDate').value;
            const end = document.getElementById('semEndDate').value;
            const tbody = document.querySelector('#scheduleTable tbody');

            if (!start || !end) { alert("è«‹å…ˆè¨­å®šå­¸æœŸå€é–“ï¼"); return; }

            // åªæœ‰æŒ‰å­¸æœŸç”¢ç”ŸæŒ‰éˆ•æ™‚ï¼Œæ‰æ¸…ç©ºè¡¨æ ¼ (é‡ç½®)
            tbody.innerHTML = "";
            document.getElementById('emptyMsg').style.display = 'none';

            let current = new Date(start);
            const endDate = new Date(end);
            
            const timeAB = document.getElementById('timeAB').value;
            const timeSilk = document.getElementById('timeSilk').value;

            while (current <= endDate) {
                const day = current.getDay();
                let act = "", time = "", add = false;

                if (mode === 'AB' || mode === 'All') {
                    if (day === 2) { act = "Aåœ˜åˆ†çµ„ï¼Båœ˜åˆå¥"; time = timeAB; add = true; }
                    if (day === 4) { act = "Aåœ˜åˆå¥ï¼Båœ˜åˆ†çµ„"; time = timeAB; add = true; }
                }
                if (mode === 'Silk' || mode === 'All') {
                    if (day === 3) { act = "çµ²ç«¹åœ˜åˆå¥"; time = timeSilk; add = true; }
                }

                if (add) insertRow(current, act, time, false);
                current.setDate(current.getDate() + 1);
            }
        }

        // --- åŠŸèƒ½ 2: åŠ å…¥æš‘è¨“ (ç´¯åŠ æ¨¡å¼) ---
        function addTrainingBatch() {
            const start = document.getElementById('trainStartDate').value;
            const end = document.getElementById('trainEndDate').value;
            const name = document.getElementById('trainName').value;
            const time = document.getElementById('trainTime').value;

            if (!start || !end) { alert("è«‹è¨­å®šæš‘è¨“é–‹å§‹èˆ‡çµæŸæ—¥æœŸï¼"); return; }

            document.getElementById('emptyMsg').style.display = 'none';

            let current = new Date(start);
            const endDate = new Date(end);

            let addedCount = 0;
            while (current <= endDate) {
                const day = current.getDay();
                // æ’é™¤é€±å…­(6)èˆ‡é€±æ—¥(0)
                if (day !== 0 && day !== 6) {
                    insertRow(current, name, time, false); // è‡ªå‹•ç”¢ç”Ÿï¼Œä½†è¦–ç‚ºæ™®é€šè¡Œ
                    addedCount++;
                }
                current.setDate(current.getDate() + 1);
            }
            
            // åŠ å…¥å¾Œé‡æ–°æ’åº
            sortTable();
            alert(`å·²åŠ å…¥ ${addedCount} å¤©çš„è¨“ç·´è¡Œç¨‹ (å·²è‡ªå‹•ç•¥éé€±æœ«)`);
        }

        // --- é€šç”¨: æ’å…¥ä¸€åˆ— ---
        function insertRow(dateObj, activity, time, isManual) {
            const tbody = document.querySelector('#scheduleTable tbody');
            const row = document.createElement('tr');
            
            const isoDate = dateObj.toISOString().split('T')[0];
            row.setAttribute('data-date', isoDate);

            const dateText = `${dateObj.getMonth() + 1}/${dateObj.getDate()}`;
            const dayText = daysMap[dateObj.getDay()];

            let dateHtml = isManual 
                ? `<input type="date" class="editable-cell" value="${isoDate}" onchange="updateRowDate(this)">` 
                : dateText;
            
            let dayHtml = isManual 
                ? `<span class="day-text">${dayText}</span>` 
                : dayText;

            row.innerHTML = `
                <td>${dateHtml}</td>
                <td>${dayHtml}</td>
                <td><input class="editable-cell" list="activityOptions" value="${activity}" placeholder="è¼¸å…¥æ´»å‹•"></td>
                <td><input class="editable-cell" value="${time}"></td>
                <td></td><td></td><td></td>
                <td><button class="del-btn" onclick="removeRow(this)">Ã—</button></td>
            `;
            tbody.appendChild(row);
            if (isManual) sortTable();
        }

        function addManualRow() {
            document.getElementById('emptyMsg').style.display = 'none';
            insertRow(new Date(), "", "", true);
        }

        function removeRow(btn) {
            btn.closest('tr').remove();
        }

        function updateRowDate(input) {
            const d = new Date(input.value);
            if (!isNaN(d)) {
                const row = input.closest('tr');
                row.setAttribute('data-date', input.value);
                row.querySelector('.day-text').innerText = daysMap[d.getDay()];
                sortTable();
            }
        }

        function sortTable() {
            const tbody = document.querySelector('#scheduleTable tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            rows.sort((a, b) => a.getAttribute('data-date').localeCompare(b.getAttribute('data-date')));
            rows.forEach(row => tbody.appendChild(row));
        }

        function clearTable() {
            if (confirm("ç¢ºå®šæ¸…ç©ºï¼Ÿ")) {
                document.querySelector('#scheduleTable tbody').innerHTML = "";
                document.getElementById('emptyMsg').style.display = 'block';
            }
        }

        function copyTable() {
            const table = document.getElementById('scheduleTable');
            const tbody = table.querySelector('tbody');
            if (tbody.rows.length === 0) { alert("ç„¡è³‡æ–™å¯è¤‡è£½"); return; }

            sortTable();
            let csv = [];
            
            // æ¨™é¡Œ
            const ths = Array.from(table.querySelectorAll('thead th')).slice(0, -1);
            csv.push(ths.map(th => th.innerText).join('\t'));

            // å…§å®¹
            table.querySelectorAll('tbody tr').forEach(row => {
                const tds = Array.from(row.querySelectorAll('td')).slice(0, -1);
                const rowData = tds.map((td, idx) => {
                    const inp = td.querySelector('input');
                    if (idx === 0 && inp && inp.type === 'date') {
                        const d = new Date(inp.value);
                        return `${d.getMonth() + 1}/${d.getDate()}`;
                    }
                    return inp ? inp.value : td.innerText;
                });
                csv.push(rowData.join('\t'));
            });

            navigator.clipboard.writeText(csv.join('\n'))
                .then(() => alert("å·²è¤‡è£½ï¼"))
                .catch(() => alert("è¤‡è£½å¤±æ•—"));
        }
    </script>
</body>
</html>
