<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨‚åœ˜å€¼ç­è¡¨ç”¢ç”Ÿå™¨ (Tooltip ç‰ˆ)</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            background-color: #f0f2f5;
        }
        h2 { color: #333; text-align: center; margin-bottom: 20px; }

        /* --- Tooltip æ¨£å¼æ ¸å¿ƒ --- */
        [data-tooltip] {
            position: relative;
            cursor: help; /* æ»‘é¼ è®Šæˆå•è™Ÿæˆ–æ‰‹æŒ‡ */
        }
        
        /* æç¤ºæ¡†æœ¬é«” */
        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%; /* é¡¯ç¤ºåœ¨ä¸Šæ–¹ */
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: #fff;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 13px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            animation: fadeIn 0.2s forwards;
            font-weight: normal;
            line-height: 1.2;
        }

        /* æç¤ºæ¡†çš„å°ç®­é ­ */
        [data-tooltip]:hover::before {
            content: '';
            position: absolute;
            bottom: 115%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #333;
            opacity: 0;
            animation: fadeIn 0.2s forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; transform: translateX(-50%) translateY(-5px); }
        }

        /* --- åŸæœ‰æ’ç‰ˆæ¨£å¼ --- */
        .config-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #555;
            margin-bottom: 15px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .date-range-global {
            text-align: center;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .date-range-global input { padding: 5px; border: 1px solid #ccc; border-radius: 4px; }

        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .action-card {
            padding: 15px;
            border-radius: 8px;
            background: #fff;
            border: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .card-ab { border-top: 4px solid #4CAF50; }
        .card-silk { border-top: 4px solid #9C27B0; }
        .card-training { border-top: 4px solid #FF5722; background-color: #fff8f5; }

        .card-header { font-weight: bold; font-size: 1.1em; color: #333; text-align: center; margin-bottom: 5px;}
        
        .input-row { display: flex; justify-content: space-between; align-items: center; font-size: 0.9em; margin-bottom: 5px; }
        .input-row input[type="text"] { width: 60%; padding: 5px; border: 1px solid #ddd; border-radius: 4px; text-align: center; }
        .input-row label { width: 35%; color: #666; font-weight: bold; }

        .day-selector {
            display: flex;
            justify-content: space-between;
            background: #f9f9f9;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #eee;
        }
        .day-checkbox { display: flex; flex-direction: column; align-items: center; cursor: pointer; font-size: 0.85em; color: #555; }
        .day-checkbox input { margin-bottom: 3px; cursor: pointer; }

        button {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
            color: white;
            transition: 0.2s;
            margin-top: auto;
        }
        button:hover { opacity: 0.9; }

        .btn-ab { background-color: #4CAF50; }
        .btn-silk { background-color: #9C27B0; }
        .btn-train { background-color: #FF5722; }
        
        .toolbar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .btn-copy { background-color: #2196F3; width: auto; padding: 10px 30px; font-size: 1.1em; }
        .btn-clear { background-color: white; border: 1px solid #ccc; color: #666; width: auto; padding: 10px 20px; }
        .btn-clear:hover { background-color: #ffebee; color: #d32f2f; border-color: #d32f2f; }

        .table-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            overflow-x: auto;
            min-height: 200px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }
        th, td {
            border: 1px solid #e0e0e0;
            padding: 8px;
            text-align: center;
            vertical-align: middle;
        }
        th { background-color: #f8f9fa; color: #495057; }
        
        input.editable-cell {
            width: 95%;
            border: 1px solid transparent;
            text-align: center;
            font-size: 15px;
            background: transparent;
            font-family: inherit;
            padding: 5px 0;
        }
        input.editable-cell:hover, input.editable-cell:focus {
            border: 1px solid #2196F3;
            background: #fff;
            border-radius: 4px;
        }
        
        .action-cell { display: flex; gap: 5px; justify-content: center; }
        .icon-btn { background: none; border: none; font-size: 16px; cursor: pointer; padding: 4px 8px; width: auto; border-radius: 4px; }
        .add-row-btn { color: #4CAF50; background: #e8f5e9; }
        .del-btn { color: #f44336; background: #ffebee; }

    </style>
</head>
<body>

    <h2>æ¨‚åœ˜å€¼ç­è¡¨ç”¢ç”Ÿå™¨ (å«æ“ä½œæç¤º)</h2>

    <div class="config-section">
        <div class="section-title">Step 1: è¨­å®šå­¸æœŸä¾‹è¡Œåœ˜ç·´</div>
        <div class="date-range-global">
            <span data-tooltip="è«‹é¸æ“‡å­¸æœŸçš„ç¬¬ä¸€å¤©èˆ‡æœ€å¾Œä¸€å¤©">å­¸æœŸå€é–“ï¼š</span>
            <input type="date" id="semStartDate" data-tooltip="å­¸æœŸé–‹å§‹æ—¥æœŸ"> è‡³ 
            <input type="date" id="semEndDate" data-tooltip="å­¸æœŸçµæŸæ—¥æœŸ">
        </div>

        <div class="action-grid">
            <div class="action-card card-ab">
                <div class="card-header" data-tooltip="ç”¢ç”Ÿ A/B åœ˜çš„ä¾‹è¡Œç·´ç¿’è¡¨">ğŸ» A/B åœ˜</div>
                
                <div class="day-selector" id="daysAB" data-tooltip="å‹¾é¸ A/B åœ˜æ¯é€±ç·´ç¿’çš„æ˜ŸæœŸ">
                    <label class="day-checkbox"><input type="checkbox" value="1"><span>ä¸€</span></label>
                    <label class="day-checkbox"><input type="checkbox" value="2" checked><span>äºŒ</span></label>
                    <label class="day-checkbox"><input type="checkbox" value="3"><span>ä¸‰</span></label>
                    <label class="day-checkbox"><input type="checkbox" value="4" checked><span>å››</span></label>
                    <label class="day-checkbox"><input type="checkbox" value="5"><span>äº”</span></label>
                </div>

                <div class="input-row">
                    <label>æ´»å‹•(äºŒ)</label>
                    <input type="text" id="txtAB_Tue" value="Aåœ˜åˆ†çµ„ï¼Båœ˜åˆå¥" data-tooltip="é€±äºŒé è¨­çš„æ´»å‹•åç¨±">
                </div>
                <div class="input-row">
                    <label>æ´»å‹•(å››)</label>
                    <input type="text" id="txtAB_Thu" value="Aåœ˜åˆå¥ï¼Båœ˜åˆ†çµ„" data-tooltip="é€±å››é è¨­çš„æ´»å‹•åç¨±">
                </div>
                <div class="input-row">
                    <label>å…¶ä»–å¤©</label>
                    <input type="text" id="txtAB_Other" value="A/Båœ˜åŠ ç·´" data-tooltip="è‹¥å‹¾é¸é€±ä¸€ä¸‰äº”ï¼Œå°‡é¡¯ç¤ºæ­¤åç¨±">
                </div>
                <div class="input-row">
                    <label>æ™‚é–“</label>
                    <input type="text" id="timeAB" value="16:00~18:30" data-tooltip="ç·´ç¿’æ™‚é–“">
                </div>
                <button class="btn-ab" onclick="generateSemester('AB')" data-tooltip="é»æ“Šç”¢ç”Ÿ A/B åœ˜è¡Œç¨‹ (æœƒæ¸…é™¤èˆŠè¡¨)">ç”¢ç”Ÿ A/B åœ˜è¡¨</button>
            </div>

            <div class="action-card card-silk">
                <div class="card-header" data-tooltip="ç”¢ç”Ÿçµ²ç«¹åœ˜çš„ä¾‹è¡Œç·´ç¿’è¡¨">ğŸ‹ çµ²ç«¹åœ˜</div>

                <div class="day-selector" id="daysSilk" data-tooltip="å‹¾é¸çµ²ç«¹åœ˜æ¯é€±ç·´ç¿’çš„æ˜ŸæœŸ">
                    <label class="day-checkbox"><input type="checkbox" value="1"><span>ä¸€</span></label>
                    <label class="day-checkbox"><input type="checkbox" value="2"><span>äºŒ</span></label>
                    <label class="day-checkbox"><input type="checkbox" value="3" checked><span>ä¸‰</span></label>
                    <label class="day-checkbox"><input type="checkbox" value="4"><span>å››</span></label>
                    <label class="day-checkbox"><input type="checkbox" value="5"><span>äº”</span></label>
                </div>

                <div class="input-row">
                    <label>æ´»å‹•å…§å®¹</label>
                    <input type="text" id="txtSilk" value="çµ²ç«¹åœ˜åˆå¥" data-tooltip="çµ²ç«¹åœ˜çš„æ´»å‹•åç¨±">
                </div>
                <div class="input-row">
                    <label>æ™‚é–“</label>
                    <input type="text" id="timeSilk" value="12:00~15:00" data-tooltip="ç·´ç¿’æ™‚é–“">
                </div>
                <button class="btn-silk" onclick="generateSemester('Silk')" data-tooltip="é»æ“Šç”¢ç”Ÿçµ²ç«¹åœ˜è¡Œç¨‹ (æœƒæ¸…é™¤èˆŠè¡¨)">ç”¢ç”Ÿ çµ²ç«¹åœ˜è¡¨</button>
            </div>
            
            <div class="action-card" style="border-top: 4px solid #333;">
                <div class="card-header">âœ¨ å­¸æœŸç¸½è¡¨</div>
                <div style="font-size: 0.9em; color: #666; text-align: center; margin: 10px 0;">
                    ä¾ç…§å·¦å´æ‰€æœ‰è¨­å®š<br>åˆä½µç”¢ç”Ÿå®Œæ•´èª²è¡¨
                </div>
                <button style="background-color: #333;" onclick="generateSemester('All')" data-tooltip="ä¸€æ¬¡ç”¢ç”Ÿ A/B åœ˜èˆ‡çµ²ç«¹åœ˜çš„æ‰€æœ‰è¡Œç¨‹">ç”¢ç”Ÿ åˆä½µç¸½è¡¨</button>
            </div>
        </div>
    </div>

    <div class="config-section" style="border: 2px solid #FF5722;">
        <div class="section-title" style="color: #FF5722; border-color: #ffd8cc;">Step 2: åŠ å…¥æš‘è¨“ / å¯’è¨“ (é€£çºŒæ—¥æœŸ)</div>
        <div class="action-grid" style="grid-template-columns: 1fr;">
            <div class="action-card card-training" style="flex-direction: row; flex-wrap: wrap; align-items: flex-end; justify-content: center;">
                <div style="display: flex; gap: 10px; align-items: center;">
                    <label>é–‹å§‹ï¼š</label><input type="date" id="trainStartDate" style="padding: 8px;" data-tooltip="é€£çºŒè¨“ç·´çš„ç¬¬ä¸€å¤©">
                    <label>çµæŸï¼š</label><input type="date" id="trainEndDate" style="padding: 8px;" data-tooltip="é€£çºŒè¨“ç·´çš„æœ€å¾Œä¸€å¤©">
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="text" id="trainName" value="æ¨‚åœ˜æš‘è¨“" placeholder="æ´»å‹•åç¨±" style="padding: 8px; width: 120px;" data-tooltip="è¨“ç·´æ´»å‹•åç¨±">
                    <input type="text" id="trainTime" value="09:00~16:00" placeholder="æ™‚é–“" style="padding: 8px; width: 100px;" data-tooltip="è¨“ç·´æ™‚é–“">
                </div>
                <button class="btn-train" style="width: auto; padding: 10px 20px;" onclick="addTrainingBatch()" data-tooltip="å°‡é€£çºŒæ—¥æœŸåŠ å…¥ç›®å‰çš„è¡¨æ ¼ä¸­ (ä¸æœƒæ¸…é™¤èˆŠè³‡æ–™)">ï¼‹ åŠ å…¥è¨“ç·´æ—¥ç¨‹</button>
            </div>
        </div>
    </div>

    <div class="toolbar">
        <button class="btn-copy" onclick="copyTable()" data-tooltip="è¤‡è£½è¡¨æ ¼å…§å®¹ï¼Œå¯ç›´æ¥è²¼ä¸Š Excel æˆ– Google Sheet">ğŸ“‹ è¤‡è£½è¡¨æ ¼åˆ° Excel</button>
        <button class="btn-clear" onclick="clearTable()" data-tooltip="æ¸…ç©ºä¸‹æ–¹æ‰€æœ‰è¡¨æ ¼å…§å®¹">ğŸ—‘ï¸ æ¸…ç©ºå…¨éƒ¨</button>
    </div>

    <div class="table-container">
        <table id="scheduleTable">
            <thead>
                <tr>
                    <th style="width: 100px;" data-tooltip="æ—¥æœŸ (MM/DD)">æ—¥æœŸ</th>
                    <th style="width: 60px;">æ˜ŸæœŸ</th>
                    <th style="width: 250px;">å€¼ç­æ™‚æ®µ/æ´»å‹•å…§å®¹</th>
                    <th style="width: 130px;">æ™‚é–“</th>
                    <th>å€¼ç­å®¶é•·ä¸€</th>
                    <th>å€¼ç­å®¶é•·äºŒ</th>
                    <th>å€¼ç­å®¶é•·ä¸‰</th>
                    <th style="width: 80px;">æ“ä½œ</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div id="emptyMsg" style="text-align: center; color: #999; padding: 40px;">
            ç›®å‰ç„¡è³‡æ–™ï¼Œè«‹è¨­å®šä¸Šæ–¹æ—¥æœŸèˆ‡æ˜ŸæœŸä¸¦ç”¢ç”Ÿ
        </div>
    </div>

    <datalist id="activityOptions">
        <option value="Aåœ˜åˆå¥ï¼Båœ˜åˆ†çµ„">
        <option value="Aåœ˜åˆ†çµ„ï¼Båœ˜åˆå¥">
        <option value="çµ²ç«¹åœ˜åˆå¥">
        <option value="çµ²ç«¹åŠ ç·´">
        <option value="Aåœ˜åŠ ç·´">
        <option value="Båœ˜åŠ ç·´">
        <option value="æ¨‚åœ˜æš‘è¨“">
        <option value="åˆ†éƒ¨æš‘è¨“">
        <option value="æˆç™¼å½©æ’">
    </datalist>

    <script>
        // åˆå§‹åŒ–æ—¥æœŸ
        window.onload = function() {
            const today = new Date();
            const threeMonthsLater = new Date();
            threeMonthsLater.setMonth(today.getMonth() + 3);
            document.getElementById('semStartDate').valueAsDate = today;
            document.getElementById('semEndDate').valueAsDate = threeMonthsLater;
            
            const nextMon = new Date();
            nextMon.setDate(today.getDate() + (1 + 7 - today.getDay()) % 7);
            const nextFri = new Date(nextMon);
            nextFri.setDate(nextMon.getDate() + 4);
            document.getElementById('trainStartDate').valueAsDate = nextMon;
            document.getElementById('trainEndDate').valueAsDate = nextFri;
        };

        const daysMap = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];

        function getSelectedDays(containerId) {
            const checkboxes = document.querySelectorAll(`#${containerId} input[type="checkbox"]:checked`);
            return Array.from(checkboxes).map(cb => parseInt(cb.value));
        }

        // --- åŠŸèƒ½ 1: ç”¢ç”Ÿå­¸æœŸä¾‹è¡Œè¡¨ ---
        function generateSemester(mode) {
            const start = document.getElementById('semStartDate').value;
            const end = document.getElementById('semEndDate').value;
            const tbody = document.querySelector('#scheduleTable tbody');

            if (!start || !end) { alert("è«‹å…ˆè¨­å®šå­¸æœŸå€é–“ï¼"); return; }

            tbody.innerHTML = "";
            document.getElementById('emptyMsg').style.display = 'none';

            let current = new Date(start);
            const endDate = new Date(end);
            
            const abDays = getSelectedDays('daysAB');
            const abTime = document.getElementById('timeAB').value;
            const abTextTue = document.getElementById('txtAB_Tue').value;
            const abTextThu = document.getElementById('txtAB_Thu').value;
            const abTextOther = document.getElementById('txtAB_Other').value;

            const silkDays = getSelectedDays('daysSilk');
            const silkTime = document.getElementById('timeSilk').value;
            const silkText = document.getElementById('txtSilk').value;

            while (current <= endDate) {
                const day = current.getDay();
                
                if (mode === 'AB' || mode === 'All') {
                    if (abDays.includes(day)) {
                        let act = abTextOther;
                        if (day === 2) act = abTextTue;
                        if (day === 4) act = abTextThu;
                        insertRow(current, act, abTime, false);
                    }
                }

                if (mode === 'Silk' || mode === 'All') {
                    if (silkDays.includes(day)) {
                        insertRow(current, silkText, silkTime, false);
                    }
                }
                current.setDate(current.getDate() + 1);
            }
        }

        // --- åŠŸèƒ½ 2: åŠ å…¥æš‘è¨“ ---
        function addTrainingBatch() {
            const start = document.getElementById('trainStartDate').value;
            const end = document.getElementById('trainEndDate').value;
            const name = document.getElementById('trainName').value;
            const time = document.getElementById('trainTime').value;

            if (!start || !end) { alert("è«‹è¨­å®šæ—¥æœŸï¼"); return; }
            document.getElementById('emptyMsg').style.display = 'none';

            let current = new Date(start);
            const endDate = new Date(end);
            
            while (current <= endDate) {
                const day = current.getDay();
                if (day !== 0 && day !== 6) { 
                    insertRow(current, name, time, false); 
                }
                current.setDate(current.getDate() + 1);
            }
            sortTable();
        }

        // --- æ ¸å¿ƒ: å»ºç«‹ä¸€åˆ— ---
        function insertRow(dateObj, activity, time, isManual, nextToRow = null) {
            const tbody = document.querySelector('#scheduleTable tbody');
            const row = document.createElement('tr');
            
            const isoDate = dateObj.toISOString().split('T')[0];
            row.setAttribute('data-date', isoDate);

            const dateText = `${dateObj.getMonth() + 1}/${dateObj.getDate()}`;
            const dayText = daysMap[dateObj.getDay()];

            let dateHtml = isManual 
                ? `<input type="date" class="editable-cell" value="${isoDate}" onchange="updateRowDate(this)" data-tooltip="é»æ“Šä¿®æ”¹æ—¥æœŸ">` 
                : dateText;
            
            let dayHtml = isManual 
                ? `<span class="day-text">${dayText}</span>` 
                : dayText;

            row.innerHTML = `
                <td>${dateHtml}</td>
                <td>${dayHtml}</td>
                <td><input class="editable-cell" list="activityOptions" value="${activity}" placeholder="è¼¸å…¥æ´»å‹•" data-tooltip="å¯è¼¸å…¥æˆ–é¸æ“‡é è¨­é¸é …"></td>
                <td><input class="editable-cell" value="${time}" data-tooltip="ä¿®æ”¹æ™‚é–“"></td>
                <td></td><td></td><td></td>
                <td class="action-cell">
                    <button class="icon-btn add-row-btn" onclick="insertRowBelow(this)" data-tooltip="åœ¨æ­¤åˆ—ä¸‹æ–¹æ’å…¥æ–°çš„ä¸€åˆ—">ï¼‹</button>
                    <button class="icon-btn del-btn" onclick="removeRow(this)" data-tooltip="åˆªé™¤æ­¤åˆ—">Ã—</button>
                </td>
            `;

            if (nextToRow) {
                nextToRow.after(row);
            } else {
                tbody.appendChild(row);
            }
        }

        function insertRowBelow(btn) {
            const currentRow = btn.closest('tr');
            const currentDateStr = currentRow.getAttribute('data-date');
            const newDate = new
